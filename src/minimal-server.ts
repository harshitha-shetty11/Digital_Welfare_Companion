import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';

dotenv.config();

const app = express();
const PORT = 3002; // Use different port to avoid conflicts

app.use(cors());
app.use(express.json());

// Simple chat endpoint that properly handles language
app.post('/api/chat', (req, res) => {
  const { message, language = 'hi', conversationHistory = [] } = req.body;
  
  console.log('=== CHAT REQUEST ===');
  console.log('Language:', language);
  console.log('Message:', message);
  console.log('===================');
  
  // Language-specific responses for testing
  const responses = {
    'en': `I understand you're asking about "${message}". Here's information about student welfare schemes in English. The government provides various scholarships and financial assistance programs for students from different backgrounds.`,
    
    'hi': `рдореИрдВ рд╕рдордЭ рдЧрдпрд╛ рдХрд┐ рдЖрдк "${message}" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫ рд░рд╣реЗ рд╣реИрдВред рдпрд╣рд╛рдБ рдЫрд╛рддреНрд░ рдХрд▓реНрдпрд╛рдгрдХрд╛рд░реА рдпреЛрдЬрдирд╛рдУрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣реИред рд╕рд░рдХрд╛рд░ рд╡рд┐рднрд┐рдиреНрди рдкреГрд╖реНрдарднреВрдорд┐ рдХреЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдХрдИ рдЫрд╛рддреНрд░рд╡реГрддреНрддрд┐ рдФрд░ рд╡рд┐рддреНрддреАрдп рд╕рд╣рд╛рдпрддрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред`,
    
    'te': `р░ор▒Ар░░р▒Б "${message}" р░Чр▒Бр░░р░┐р░Вр░Ър░┐ р░Ер░бр▒Бр░Чр▒Бр░др▒Бр░ир▒Нр░ир░╛р░░р░ир░┐ р░ир▒Зр░ир▒Б р░Ер░░р▒Нр░ер░В р░Ър▒Зр░╕р▒Бр░Хр▒Бр░ир▒Нр░ир░╛р░ир▒Б. р░Зр░Хр▒Нр░Хр░б р░╡р░┐р░жр▒Нр░пр░╛р░░р▒Нр░ер░┐ р░╕р░Вр░Хр▒Нр░╖р▒Зр░о р░кр░ер░Хр░╛р░▓ р░Чр▒Бр░░р░┐р░Вр░Ър░┐ р░╕р░ор░╛р░Ър░╛р░░р░В р░Йр░Вр░жр░┐. р░кр▒Нр░░р░нр▒Бр░др▒Нр░╡р░В р░╡р░┐р░╡р░┐р░з р░ир▒Зр░кр░ер▒Нр░пр░╛р░▓ р░ир▒Бр░Вр░бр░┐ р░╡р░Ър▒Нр░Ър░┐р░и р░╡р░┐р░жр▒Нр░пр░╛р░░р▒Нр░ер▒Бр░▓р░Хр▒Б р░Ер░ир▒Зр░Х р░╕р▒Нр░Хр░╛р░▓р░░р▒НтАМр░╖р░┐р░кр▒НтАМр░▓р▒Б р░ор░░р░┐р░пр▒Б р░Жр░░р▒Нр░ер░┐р░Х р░╕р░╣р░╛р░п р░Хр░╛р░░р▒Нр░пр░Хр▒Нр░░р░ор░╛р░▓р░ир▒Б р░Ер░Вр░жр░┐р░╕р▒Нр░др▒Бр░Вр░жр░┐.`,
    
    'ta': `роирпАроЩрпНроХро│рпН "${message}" рокро▒рпНро▒ро┐ роХрпЗроЯрпНроХро┐ро▒рпАро░рпНроХро│рпН роОройрпНро▒рпБ роиро╛ройрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНроХро┐ро▒рпЗройрпН. роЗроЩрпНроХрпЗ рооро╛рогро╡ро░рпН роиро▓родрпН родро┐роЯрпНроЯроЩрпНроХро│рпН рокро▒рпНро▒ро┐роп родроХро╡ро▓рпН роЙро│рпНро│родрпБ. роЕро░роЪро╛роЩрпНроХроорпН рокро▓рпНро╡рпЗро▒рпБ рокро┐ройрпНройрогро┐ропро┐ро▓ро┐ро░рпБроирпНродрпБ ро╡ро░рпБроорпН рооро╛рогро╡ро░рпНроХро│рпБроХрпНроХрпБ рокро▓рпНро╡рпЗро▒рпБ роЙродро╡ро┐родрпНродрпКроХрпИроХро│рпН рооро▒рпНро▒рпБроорпН роиро┐родро┐ роЙродро╡ро┐ родро┐роЯрпНроЯроЩрпНроХро│рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.`,
    
    'bn': `ржЖржорж┐ ржмрзБржЭрждрзЗ ржкрж╛рж░ржЫрж┐ ржЖржкржирж┐ "${message}" рж╕ржорзНржкрж░рзНржХрзЗ ржЬрж┐ржЬрзНржЮрж╛рж╕рж╛ ржХрж░ржЫрзЗржиред ржПржЦрж╛ржирзЗ ржЫрж╛рждрзНрж░ ржХрж▓рзНржпрж╛ржг ржкрзНрж░ржХрж▓рзНржк рж╕ржорзНржкрж░рзНржХрзЗ рждржерзНржп рж░ржпрж╝рзЗржЫрзЗред рж╕рж░ржХрж╛рж░ ржмрж┐ржнрж┐ржирзНржи ржкржЯржнрзВржорж┐рж░ ржЫрж╛рждрзНрж░ржжрзЗрж░ ржЬржирзНржп ржмрж┐ржнрж┐ржирзНржи ржмрзГрждрзНрждрж┐ ржПржмржВ ржЖрж░рзНржерж┐ржХ рж╕рж╣рж╛ржпрж╝рждрж╛ ржХрж░рзНржорж╕рзВржЪрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред`,
    
    'gu': `рк╣рлБркВ рк╕ркоркЬрлА ркЧркпрлЛ ркХрлЗ ркдркорлЗ "${message}" рк╡рк┐рк╢рлЗ рккрлВркЫрлА рк░рк╣рлНркпрк╛ ркЫрлЛ. ркЕрк╣рлАркВ рк╡рк┐ркжрлНркпрк╛рк░рлНркерлА ркХрк▓рлНркпрк╛ркг ркпрлЛркЬркирк╛ркУ рк╡рк┐рк╢рлЗ ркорк╛рк╣рк┐ркдрлА ркЫрлЗ. рк╕рк░ркХрк╛рк░ рк╡рк┐рк╡рк┐ркз рккрлГрк╖рлНркаркнрлВркорк┐ркирк╛ рк╡рк┐ркжрлНркпрк╛рк░рлНркерлАркУ ркорк╛ркЯрлЗ рк╡рк┐рк╡рк┐ркз рк╢рк┐рк╖рлНркпрк╡рлГркдрлНркдрк┐ ркЕркирлЗ ркирк╛ркгрк╛ркХрлАркп рк╕рк╣рк╛ркпркдрк╛ ркХрк╛рк░рлНркпркХрлНрк░ркорлЛ рккрлНрк░ркжрк╛рки ркХрк░рлЗ ркЫрлЗ.`,
    
    'kn': `р▓ир│Ар▓╡р│Б "${message}" р▓мр▓Чр│Нр▓Чр│Ж р▓Хр│Зр▓│р│Бр▓др│Нр▓др▓┐р▓жр│Нр▓жр│Ар▓░р▓┐ р▓Ор▓Вр▓жр│Б р▓ир▓╛р▓ир│Б р▓Ер▓░р│Нр▓ер▓ор▓╛р▓бр▓┐р▓Хр│Кр▓Вр▓бр▓┐р▓жр│Нр▓жр│Зр▓ир│Ж. р▓Зр▓▓р│Нр▓▓р▓┐ р▓╡р▓┐р▓жр│Нр▓пр▓╛р▓░р│Нр▓ер▓┐ р▓Хр▓▓р│Нр▓пр▓╛р▓г р▓пр│Лр▓Ьр▓ир│Жр▓Чр▓│ р▓мр▓Чр│Нр▓Чр│Ж р▓ор▓╛р▓╣р▓┐р▓др▓┐ р▓Зр▓жр│Ж. р▓╕р▓░р│Нр▓Хр▓╛р▓░р▓╡р│Б р▓╡р▓┐р▓╡р▓┐р▓з р▓╣р▓┐р▓ир│Нр▓ир│Жр▓▓р│Жр▓п р▓╡р▓┐р▓жр│Нр▓пр▓╛р▓░р│Нр▓ер▓┐р▓Чр▓│р▓┐р▓Чр│Ж р▓╡р▓┐р▓╡р▓┐р▓з р▓╡р▓┐р▓жр│Нр▓пр▓╛р▓░р│Нр▓ер▓┐р▓╡р│Зр▓др▓и р▓ор▓др│Нр▓др│Б р▓Жр▓░р│Нр▓ер▓┐р▓Х р▓╕р▓╣р▓╛р▓п р▓Хр▓╛р▓░р│Нр▓пр▓Хр│Нр▓░р▓ор▓Чр▓│р▓ир│Нр▓ир│Б р▓Тр▓жр▓Чр▓┐р▓╕р│Бр▓др│Нр▓др▓жр│Ж.`,
    
    'ml': `р┤ир┤┐р┤Щр╡Нр┤Щр╡╛ "${message}" р┤Ор┤ир╡Нр┤ир┤др┤┐р┤ир╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър╡Н р┤Ър╡Лр┤жр┤┐р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Бр┤гр╡Нр┤Яр╡Жр┤ир╡Нр┤ир╡Н р┤Юр┤╛р╡╗ р┤ор┤ир┤╕р╡Нр┤╕р┤┐р┤▓р┤╛р┤Хр╡Нр┤Хр╡Бр┤ир╡Нр┤ир╡Б. р┤Зр┤╡р┤┐р┤Яр╡Ж р┤╡р┤┐р┤жр╡Нр┤пр┤╛р╡╝р┤др╡Нр┤ер┤┐ р┤Хр╡Нр┤╖р╡Зр┤о р┤кр┤жр╡Нр┤зр┤др┤┐р┤Хр┤│р╡Жр┤Хр╡Нр┤Хр╡Бр┤▒р┤┐р┤Ър╡Нр┤Ър╡Бр┤│р╡Нр┤│ р┤╡р┤┐р┤╡р┤░р┤Щр╡Нр┤Щр┤│р╡Бр┤гр╡Нр┤Яр╡Н. р┤╕р╡╝р┤Хр╡Нр┤Хр┤╛р╡╝ р┤╡р┤┐р┤╡р┤┐р┤з р┤кр┤╢р╡Нр┤Ър┤╛р┤др╡Нр┤др┤▓р┤др╡Нр┤др┤┐р╡╜ р┤ир┤┐р┤ир╡Нр┤ир╡Бр┤│р╡Нр┤│ р┤╡р┤┐р┤жр╡Нр┤пр┤╛р╡╝р┤др╡Нр┤ер┤┐р┤Хр╡╛р┤Хр╡Нр┤Хр╡Н р┤╡р┤┐р┤╡р┤┐р┤з р┤╕р╡Нр┤Хр╡Лр┤│р╡╝р┤╖р┤┐р┤кр╡Нр┤кр╡Бр┤Хр┤│р╡Бр┤В р┤╕р┤╛р┤ор╡Нр┤кр┤др╡Нр┤др┤┐р┤Х р┤╕р┤╣р┤╛р┤п р┤кр┤░р┤┐р┤кр┤╛р┤Яр┤┐р┤Хр┤│р╡Бр┤В р┤ир╡╜р┤Хр╡Бр┤ир╡Нр┤ир╡Б.`,
    
    'mr': `рддреБрдореНрд╣реА "${message}" рдмрджреНрджрд▓ рд╡рд┐рдЪрд╛рд░рдд рдЖрд╣рд╛рдд рд╣реЗ рдорд▓рд╛ рд╕рдордЬрд▓реЗ рдЖрд╣реЗ. рдпреЗрдереЗ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдХрд▓реНрдпрд╛рдг рдпреЛрдЬрдирд╛рдВрдЪреА рдорд╛рд╣рд┐рддреА рдЖрд╣реЗ. рд╕рд░рдХрд╛рд░ рд╡рд┐рд╡рд┐рдз рдкрд╛рд░реНрд╢реНрд╡рднреВрдореАрддреАрд▓ рд╡рд┐рджреНрдпрд╛рд░реНрдереНрдпрд╛рдВрд╕рд╛рдареА рд╡рд┐рд╡рд┐рдз рд╢рд┐рд╖реНрдпрд╡реГрддреНрддреА рдЖрдгрд┐ рдЖрд░реНрдерд┐рдХ рд╕рд╣рд╛рдпреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдо рдкреНрд░рджрд╛рди рдХрд░рддреЗ.`,
    
    'or': `рморнБрмБ рммрнБрмЭрм┐рмкрм╛рм░рнБрмЫрм┐ рмпрнЗ рмЖрмкрмг "${message}" рммрм┐рм╖рнЯрм░рнЗ рмкрмЪрм╛рм░рнБрмЫрмирнНрмдрм┐ред рмПрмарм╛рм░рнЗ рмЫрм╛рмдрнНрм░ рмХрм▓рнНрнЯрм╛рмг рмпрнЛрмЬрмирм╛ рммрм┐рм╖рнЯрм░рнЗ рм╕рнВрмЪрмирм╛ рмЕрмЫрм┐ред рм╕рм░рмХрм╛рм░ рммрм┐рмнрм┐рмирнНрми рмкрнГрм╖рнНрмармнрнВрморм┐рм░ рмЫрм╛рмдрнНрм░рморм╛рмирмЩрнНрмХ рмкрм╛рмЗрмБ рммрм┐рмнрм┐рмирнНрми рмЫрм╛рмдрнНрм░рммрнГрмдрнНрмдрм┐ рмПрммрмВ рмЖрм░рнНрмерм┐рмХ рм╕рм╣рм╛рнЯрмдрм╛ рмХрм╛рм░рнНрмпрнНрнЯрмХрнНрм░рмо рмкрнНрм░рмжрм╛рми рмХрм░рмирнНрмдрм┐ред`,
    
    'pa': `риорйИриВ ри╕риориЭ риЧри┐риЖ риХри┐ ридрйБри╕рйАриВ "${message}" римри╛ри░рйЗ рикрйБрй▒риЫ ри░ри╣рйЗ ри╣рйЛред риЗрй▒риерйЗ ри╡ри┐рижри┐риЖри░риерйА риХри▓ри┐риЖриг рипрйЛриЬриири╛ри╡ри╛риВ римри╛ри░рйЗ риЬри╛ригриХри╛ри░рйА ри╣рйИред ри╕ри░риХри╛ри░ ри╡рй▒риЦ-ри╡рй▒риЦ рикри┐риЫрйЛриХрйЬ рижрйЗ ри╡ри┐рижри┐риЖри░риерйАриЖриВ ри▓риИ ри╡рй▒риЦ-ри╡рй▒риЦ ри╕риХри╛ри▓ри░ри╕ри╝ри┐рик риЕридрйЗ ри╡ри┐рй▒ридрйА ри╕ри╣ри╛риЗридри╛ рикрйНри░рйЛриЧри░ри╛рио рикрйНри░рижри╛рии риХри░рижрйА ри╣рйИред`,
    
    'ur': `┘Е█М┌║ ╪│┘Е╪м┌╛ ┌п█М╪з ┌й█Б ╪в┘╛ "${message}" ┌й█Т ╪и╪з╪▒█Т ┘Е█М┌║ ┘╛┘И┌Ж┌╛ ╪▒█Б█Т █Б█М┌║█Ф █М█Б╪з┌║ ╪╖┘Д╪и╪з╪б ┌й█М ┘Б┘Д╪з╪н█М ╪з╪│┌й█М┘Е┘И┌║ ┌й█М ┘Е╪╣┘Д┘И┘Е╪з╪к █Б█М┌║█Ф ╪н┌й┘И┘Е╪к ┘Е╪о╪к┘Д┘Б ┘╛╪│ ┘Е┘Ж╪╕╪▒ ┌й█Т ╪╖┘Д╪и╪з╪б ┌й█Т ┘Д█М█Т ┘Е╪о╪к┘Д┘Б ┘И╪╕╪з╪ж┘Б ╪з┘И╪▒ ┘Е╪з┘Д█М ╪з┘Е╪п╪з╪п ┌й█Т ┘╛╪▒┘И┌п╪▒╪з┘Е ┘Б╪▒╪з█Б┘Е ┌й╪▒╪к█М █Б█Т█Ф`
  };
  
  const response = responses[language as keyof typeof responses] || responses['hi'];
  
  res.json({
    response,
    schemes: [],
    sessionId: 'test-session',
    extractedInfo: {},
    debug: {
      receivedLanguage: language,
      selectedResponse: language in responses ? language : 'hi (fallback)'
    }
  });
});

// Health check
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    timestamp: new Date().toISOString(),
    message: 'Minimal server running for language testing'
  });
});

app.listen(PORT, () => {
  console.log(`ЁЯЪА Minimal server running on port ${PORT}`);
  console.log(`ЁЯМР Health check: http://localhost:${PORT}/health`);
  console.log(`ЁЯТм Chat endpoint: http://localhost:${PORT}/api/chat`);
});
